<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>USA presidendivalimised</title>
		<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.4/Chart.js"></script>
	</head>

	<body>
		<div class="container">
			<canvas id="myChart"></canvas>
			<span id="winner"></span>
		</div>

		<style>
			.container {
				width: 80%;
				margin: 15px auto;
			}
		</style>

		<script>
		function presidentialElections() {
			$.getJSON( "p.json", function( data ) {
				var items = [];
				items.push(data.candidates);

				var ctx = document.getElementById('myChart').getContext('2d');
					var myChart = new Chart(ctx, {
					  type: 'bar',
					  data: {
					    labels: [items[0][0].lname, items[0][1].lname],
					    datasets: [{
					      label: items[0][0].lname,
					      data: [items[0][0].evotes, 0],
					      backgroundColor: "rgba(255, 69, 74, 0.5)",
								borderColor: [
									'rgba(255, 0, 0, 1)'
								],
								borderWidth: 1
					    }, {
								label: items[0][1].lname,
					      data: [0, items[0][1].evotes],
					      backgroundColor: "rgba(46, 140, 255, 0.5)",
					      borderColor: [
					                'rgba(0, 0, 255, 1)',
					            ],
					    borderWidth: 1
						}]
						},
						options: {
							title: {
		  					display: true,
		  					text: "USA presidendivalimised"
		  				},
		  				animation: {
		  					easing: 'easeInOutElastic'
		  				},
							legend: {
		  					display: true
		  				},
							scales: {
								yAxes: [{
									ticks: {
										beginAtZero: true,
										min: 200,
									}
								}]
							}
						}
					});
					// Trump winner
					if(items[0][0].winner === true) {
						$("#winner").html("Winner: " +  "<span style='color:red'>Donald " + items[0][0].lname + "</span>");
					}
					// Clinton winner
					if(items[0][1].winner === true) {
						$("#winner").html("Winner: " +  "<span style='color:blue'>Hillary " + items[0][1].lname + "</span>");
					}
				});
			}

			presidentialElections();

			setInterval(function() {
					presidentialElections();
			}, 20000);
		</script>
	</body>
</html>
